<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>نظام الحضور والغياب</title>
<style>
:root{--bg:#f6f9fc;--card:#fff;--accent:#0b74da;--muted:#6b6b6b}
body{margin:0;background:var(--bg);font-family:'Noto Kufi Arabic',sans-serif}
header{background:linear-gradient(90deg,var(--accent),#2ea3ff);color:white;padding:18px}
main{padding:20px;max-width:1100px;margin:auto}
.card{background:#fff;padding:18px;margin-bottom:18px;border-radius:12px;box-shadow:0 4px 14px rgba(0,0,0,.08)}
a{color:var(--accent);text-decoration:none}
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border:1px solid #eee;text-align:center}
</style>

</head>
<body>
<header><h2>نظام الحضور والغياب</h2></header>
<main>

<div class="card">
<h2>نظام الحضور والغياب</h2>
<p>أضف حضور اليوم لكل طالب ثم احفظ أو نزّل CSV.</p>
<form id="attForm">
  <label>اسم الطالب: <input id="stu" required></label>
  <label>القسم: <select id="section"><option>بنين</option><option>بنات</option></select></label>
  <label>الحالة: <select id="status"><option>حاضر</option><option>غائب</option></select></label>
  <button type="submit">أضف</button>
</form>
<div style="margin-top:12px">
<button id="export">تحميل CSV</button>
<button id="clear">مسح الكل</button>
</div>
<div id="list" style="margin-top:12px"></div>
</div>
<script>
const STORAGE_KEY='attendance_records_v1';
function load(){ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }
function save(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
function render(){
  const list = load();
  const el = document.getElementById('list');
  if(!list.length){ el.innerHTML='<p class="muted">لا توجد سجلات حتى الآن.</p>'; return; }
  let html='<table><tr><th>الاسم</th><th>القسم</th><th>الحالة</th><th>الوقت</th></tr>';
  list.forEach(r=> html+=`<tr><td>${r.name}</td><td>${r.section}</td><td>${r.status}</td><td>${r.time}</td></tr>`);
  html+='</table>';
  el.innerHTML=html;
}
document.getElementById('attForm').addEventListener('submit', function(e){
  e.preventDefault();
  const name=document.getElementById('stu').value.trim();
  const section=document.getElementById('section').value;
  const status=document.getElementById('status').value;
  const rec={name,section,status,time:new Date().toLocaleString()};
  const arr=load(); arr.push(rec); save(arr); render();
  this.reset();
});
document.getElementById('export').addEventListener('click', function(){
  const arr=load();
  if(!arr.length){ alert('لا توجد بيانات للتصدير'); return; }
  const csv=[['الاسم','القسم','الحالة','الوقت']].concat(arr.map(r=>[r.name,r.section,r.status,r.time]));
  const csvContent = csv.map(e=>e.map(v=>`"\${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob=new Blob([csvContent],{type:'text/csv;charset=utf-8;'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='attendance.csv'; a.click(); URL.revokeObjectURL(url);
});
document.getElementById('clear').addEventListener('click', function(){
  if(confirm('هل تريد مسح كل سجلات الحضور؟')){ localStorage.removeItem(STORAGE_KEY); render(); }
});
render();
</script>

</main>
</body>
</html>